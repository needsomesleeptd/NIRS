\chapter{Аналитический раздел}
В данной части работы, будет рассмотрена структура PDF файла, основные ошибки студентов, допускаемые при написании отчетов,
а также рассмотрены различные виды PDF файлов.

В современном мире одними из самых популярных форматов электронных документов являются формат docx и PDF, ввиду этого именного в данных форматах отчеты представляются на проверку~\cite{pdf_pop}.
Формат файлов PDF имеет статус международного  стандарта~(закреплён ISO/IEC 32000-1:2008)~\cite{pdf_iso}, различные типы формата PDF поддержиываются различными международными стандартами (например PDF/A-1 поддерживается стандартом ISO 19005-1, PDF/E стандартом ISO 24517 и т.~д.)~\cite{pdf_iso_e,pdf_iso_a}.

\section{Структура PDF файла}
Для получения и анализа данных из файла формата PDF необходимо рассмотреть его структуру.

\subsection{Разделы PDF файла}
Структура PDF файла включает 4 раздела:
\begin{enumerate}
	\item заголовок;
	\item тело;
	\item таблица перекрестных ссылок;
	\item хвост \cite{pdf_object_def}.
\end{enumerate}

\subsubsection{Заголовок}
Заголовком называется первая строка файла, он содержит информацию о версии PDF~\cite{pdf_object_def}, пример: \texttt{\%PDF-1.5}.


\subsubsection{Тело}
Все содержимое документа находится в теле файла. Информация, которая отображается пользователю представлена восемью типами данных:
\begin{enumerate}
	\item булевы значения. Принимают значения true или false;
	\item числа. integer (целочисленный) и real (вещественный), дробная часть в вещественных числах отделяется точкой;
	\item имена. Последовательность ASCII символов, начинаются со слеша, который не входит в имя, вместо непосредственно символов могут включать их шестнадцатеричные коды, начинающиеся с символа \#;
	\item строки. Ограничены длиной в 65535 байтов, записываются в круглых либо треугольных скобках, могут быть представлены как ASCII символами, так и шестнадцатеричными или восьмеричными кодами.
	\item массивы. Могут содержать любые PDF-объекты, элементы разделяются пробелом и заключаются в квадратные скобки;
	\item словари. Представляют коллекцию пар ключ-значение. Ключом должно быть имя, а значением может быть любой объект. Запись словаря начинается с символов «, а заканчиваются — »;
	\item потоки. Потоки содержат неограниченные последовательности байтов. В них содержится основное содержимое документов. Поток начинается с ключевого слова \texttt{stream} и заканчивается словом \texttt{endstream}. Перед началом потока записывается словарь с мета-информацией, включающей данные о количестве байтов, фильтре применимом их к обработке и т.~д.
	\item null-объекты. Представляются ключевым словом \texttt{null} \cite{pdf_object_def}.
\end{enumerate}
\textbf{PDF объектом} является любой вышеперечисленный тип, содержащий информацию~\cite{pdf_object_def}.



\subsubsection{Хвост}
Данный раздел начинается с ключевого слова \texttt{trailer} и содержит несколько значений.
\begin{enumerate}
	\item Словарь, содержащий:
	\begin{itemize}
		\item данные о количестве объектов (ключевое слово \texttt{Size});
		\item ссылки на каталог документа (ключевое слово \texttt{Root});
		\item информационный словарь (ключевое слово \texttt{Info});
		\item идентификатор файла (ключевое слово \texttt{ID}) \cite{pdf_object_def}.
	\end{itemize}
	\item Смещение относительно таблицы  перекрестных ссылок (англ. cross-reference table);
	\item Маркер конца файла \texttt{\%\%EOF}.
\end{enumerate}
Пример <<хвоста>> PDF файла приведен в листинге \ref{lst:tail}.


	



\subsubsection{Таблица  перекрестных ссылок}
Cross-reference table состоит из нескольких секций, каждая из которых соответствует новой версии документа, и позволяет получать произвольный доступ к любому объекту в файле, данная таблица начинается с ключевого слова \texttt{xref}, так что иногда ее называют xref таблицей \cite{pdf_structure_trans}.

\begin{lstlisting}[label=lst:xref,caption=Пример таблицы перекрестных ссылок]
	xref
	0 44
	0000000000 65535 f 
	0000000361 00000 n 
	0000000257 00000 n 
	0000000015 00000 n 
\end{lstlisting}






Любой PDF-объект может быть помечен уникальным идентификатором и использоваться как ссылка, называемые косвенными, данные объекты начинаются с идентификатора, номера поколения и ключевого слова \texttt{obj}, а заканчиваются словом \texttt{endobj}. На такие объекты можно ссылаться в таблице 
cross-reference table и любом другом объекте (для этого используется символ R) \cite{pdf_structure_trans}. 

\subsection{Хранение страниц}
С точки зрения организации  страниц PDF документ имеет иерархическую структуру (дерево), корнем которого является словарь
Catalog, содержащий ссылку на дерево страниц и ссылку на словарь ссылок на иные элементы документа.
Каждый элемент дерева страниц хранит в себе всю информацию, отображаемую на странице:
выравнивание страницы, картинки, текст и т.~д., данный тип хранения позволяет ускорить доступ к объектам на странице~\cite{pdf_object_def,pdf_tree}.


\section{Виды PDF форматов}
Существует несколько различных видов PDF документов, каждый из которых имеет свои особенности и ограничения:
\begin{enumerate}
	\item PDF/A;
	\item PDF/X;
	\item PDF/E;
	\item PDF/UA.
\end{enumerate}

\subsection{PDF/A}

Предназначен для долгосрочного хранения документов. Он обеспечивает сохранность и неприкосновенность содержимого.
Данный формат также разделяется на несколько подклассов: PDF/A-1, PDF/A-2, PDF/A-3, PDF/A-4~\cite{pdf_levels_std}.


Также вводится новое понятие уровня соответствия, оно накладывает дополнительные требования на классы PDF/A, для предоставления дополнительных возможностей.
\begin{enumerate}
	\item Уровень b (Basic).
	Цель: обеспечение надёжного воспроизведения внешнего вида документа.
	Распространяется на файлы формата: PDF/A-1b, PDF/A-2b, PDF/A-3b;
	\item уровень a (Accessible).
	Цель: обеспечение возможности поиска и преобразования содержимого документа.
	Включает все требования уровня b и дополнительно требует, чтобы была включена структура документа.
	Также вводит требования:
	\begin{enumerate}
		\item Содержимое должно быть помечено деревом иерархической структуры, что означает, что такие элементы, как порядок чтения, рисунки и таблицы, явно идентифицируются с помощью метаданных.
		\item Должен быть указан естественный язык документа.
		\item Изображения и символы должны иметь альтернативный описательный текст.
		Файл должен включать сопоставление символов с Unicode.
	\end{enumerate}
	Распространяется на файлы формата: PDF/A-1a, PDF/A-2a, PDF/A-3a;
	
	\item уровень u (Unicode).
	Распространяется на файлы формата: PDF/A-2u, PDF/A-3u.
	Требуется сопоставление символов с Unicode.
	Изменения:
	отбрасываются требования уровня a, включая встроенную логическую структуру (т. е. теги и дерево структур);
	
	\item уровень f (Format).
	Распространяется на файлы формата: PDF/A-4f.
	Изменения:
	позволяет встраивать типы файлов любого другого формата;
	
	\item уровень e (Engineering).
	Распространяется на файлы формата: PDF/A-4e.
	Изменения:
	поддержка аннотаций типов RichMedia и 3D \cite{pdf_levels_std}.
\end{enumerate}


\subsubsection{PDF/A-1}
PDF/A-1 самый распространенный формат оригинального PDF/A на сегодняшний день. Он основан на PDF 1.4 и является наиболее ограниченным, так как не поддерживает JPEG 2000, вложения, слои и прозрачность. Часть 1 стандарта была опубликована 28 сентября 2005 года и определяет два уровня соответствия для файлов PDF: PDF/A-1b и PDF/A-1a~\cite{pdf_a_2}.


\subsubsection{PDF/A-2}
PDF/A-2 дополняет A-1 новыми функциями:
\begin{enumerate}
	\item поддерживает сжатие JPEG2000, что особенно полезно для отсканированных документов (карты, книги), а также документов с цветным содержимым (чеки или паспорта);
	\item вложенные файлы PDF/A через коллекции: Acrobat позволяет пользователям создавать коллекции (иногда также называемые <<портфелями>>), где несколько документов PDF/A объединяются в один <<контейнерный>> документ PDF;
	
	\item поддерживает необязательное содержимое (слои): необязательное содержимое, иногда также называемое слоями, полезно для приложений картографии или инженерных чертежей, где отдельные слои могут быть показаны или скрыты в соответствии с требованиями просмотра;
	\item поддерживает новый уровень соответствия PDF/A-2u --- <<u>> для Unicode, упрощающий поиск и копирование текста Unicode для цифровых PDF-документов и PDF-документов, которые были отсканированы с последующим оптическим распознаванием символов (OCR)~\cite{pdf_a_2};
	
	\item поддерживает хранение метаданных на уровне объекта XMP: PDF/A-2 определяет требования к настраиваемым метаданным XMP;
	
\end{enumerate}
\subsubsection{PDF/A-3}
PDF/A-3 расширяет PDF/A-2, поддерживая добавления любых файлов, а не только PDF типа A, однако не гарантирует валидность их прочтения в будущем~\cite{pdf_a_2}.

Также адаптирован для использования в электронном документообороте~\cite{nalogi}.
\subsubsection{PDF/A-4}
Основное отличие данного вида, является отказ от уровней соответствия a, b и c. PDF/A-4 требует отображения в юникоде для всех шрифтов~\cite{pdf_a_4}.

\subsection{PDF/X}
Формат, разработанный специально для обмена и печати документов в издательской отрасли. Он обеспечивает точность цветов и расположения элементов страницы, что особенно важно при печати~\cite{abdobe_PDF}.


\subsection{PDF/E}
Формат, предназначенный для обмена и хранения документов в инженерной отрасли. Он поддерживает вставку трехмерных моделей, векторных изображений и технической документации~\cite{abdobe_PDF}.
\subsection{PDF/UA}
Формат, предназначенный для создания доступных документов для пользователей с ограниченными возможностями. Он обеспечивает структурированное представление контента и поддержку технологий чтения вслух и распознавания речи~\cite{abdobe_PDF}.






\section{Основные ошибки в отчетах}
В данном разделе будут рассмотрены наиболее часто встречающиеся ошибки, которые совершают студенты при написании различных отчетов.

В целях выявления наиболее часто встречающихся ошибок были опрошены преподаватели, работа которых непосредственно связана с проверкой отчетов студентов.

\subsection{Общие ошибки}
В ГОСТ 7.32 указаны следующие размеры полей: левое --- 30 мм, правое --- 15 мм, верхнее и нижнее --- 20 мм~\cite{GOST732}. Выход за границы листа является одной из самых распространенных ошибок.

Каждый объект (таблица, рисунок, схема алгоритма, формула) должен быть подписан и пронумерован, однако более подробно подписи к каждому из них будут рассмотрены в следующих подразделах.

Если таблицу или схему не удается разместить на одной странице, то следует разбить данный объект на несколько частей, каждая из которых должна быть подписана.

\subsection{Ошибки в тексте}
Слова в тексте должны быть согласованы в роде, числе и падеже.

Страницы отчета должны быть пронумерованы, однако, номер на титульном листе не ставится, но он является первой страницей, что означает, что следующая страница должна иметь номер ${2}$.

Ненумерованный заголовок (введение, список литературы, оглавление и т. п.) должен быть выравнен по центру, при этом он состоит только из прописных букв (пример представлен в приложении~\ref{img:chapterNameMist}), другие варианты оформления являются не соответствующими стандарту.

Абзацный отступ должен быть одинаковым по всему тексту отчета и равен 1,25 см~\cite{GOST732}. Любые другие варианты оформления считаются ошибочными.

Возможна потеря научного стиля и переход к публицистике, что является ошибкой, текст работы должен быть написан на государственном языке в научном стиле.

\subsection{Ошибки в рисунках}
Частой ошибкой является неправильное оформление рисунков. Каждый рисунок должен быть подписан, при этом подпись должна располагаться строго по центру, внизу рисунка. Другое оформление считается ошибочным.

Использование рисунков низкого разрешения является ошибкой. Все рисунки должны быть выполнены в высоком качестве, если обратное не требуется в самой работе.

Некорректный поворот рисунка считается ошибкой. Если рисунок не удается разместить на странице, то допускается повернуть его таким образом, чтобы верх рисунка был ближе к левой части страницы (см. рисунок~\ref{img:imgRotateMist}).

\subsubsection{Ошибки в графиках}
Для каждого графика должна существовать легенда, для оформления которой существует два варианта:
\begin{itemize}
	\item в одном из углов графика находится область, в которой указаны все обозначения;
	\item в подписи к графику описано каждое обозначение;
\end{itemize}
другое оформление является ошибкой.

Часто на графиках отсутствуют единицы измерения, что является ошибкой. Должны быть подписаны единицы измерения каждой из осей графика, даже в том случае, если на графике оси подписываются словами, например, если измерение идет в штуках или на оси обозначены времена года (см. рисунок~\ref{img:graphAxesMist}).

Отчеты могут быть напечатаны в черно-белом варианте, поэтому на графиках должны быть маркеры, которые позволят отличить графики друг от друга даже не в цветом варианте. Отсутствие маркеров считается ошибкой.

При большом количестве графиков на одном рисунке возможна ситуация, при которой невозможно отличить один график от другого, что является ошибкой.

\subsubsection{Ошибки в схемах алгоритмов}
Если схему не удается разместить на одной странице, то она разбивается на несколько частей, каждая из которых должна быть подписана. Для разделения схемы алгоритма на части используется специальный символ-соединитель, который отображает выход в часть схемы и вход из другой части этой схемы, соответствующие символы-соединители должны содержать одно и то же уникальное обозначение, любые другие варианты оформления являются ошибочными.

Часто вместо символа начала или конца алгоритма используют овал, однако в этом случае должен быть использован прямоугольник с закругленными углами (см. рисунок~\ref{img:schemeStartMist}).

При использовании символа процесса (прямоугольник) часто используют прямоугольник с закругленными углами (см. рисунок~\ref{img:schemeRectMist}), что является ошибкой.

При соединении символов схемы алгоритмов не нужны стрелки, если они соединяют символы в направлении слево-направо или сверху-вниз, в остальных случаях символы должны соединяться линиями со стрелкой на конце, отсутствие требуемых стрелок считается ошибкой.

При использовании символа процесса-решение как минимум одна из соединительных линий должна быть подписана (см. рисунок~\ref{img:schemeDecMist}), однако возможен также вариант, когда подписаны обе линии. Отсутствие пояснений к выходам данного символа является ошибкой.

Часто пояснительный текст пересекается с символами, использующимися для составления схем, что является ошибкой.

\subsection{Ошибки в таблицах}
Каждая таблица должна быть подписана. Наименование следует помещать над таблицей слева, без абзацного отступа в следующем формате: Таблица Номер таблицы - Наименование таблицы. Наименование таблицы приводят с прописной буквы без точки в конце~\cite{GOST732}. Другие варианты оформления считаются не соответствующими стандарту.

Таблицу с большим количеством строк допускается переносить на другую страницу. При переносе части таблицы на другую страницу слово «Таблица», ее номер и наименование указывают один раз слева над первой частью таблицы, а над другими частями также слева пишут слова «Продолжение таблицы» и указывают номер таблицы~\cite{GOST732}. Любое другое оформление считается ошибочным.

\subsection{Ошибки в формулах}
Каждая формула должна быть пронумерована вне зависимости от того, существует ли ссылка на нее. Нумерация может осуществляться в двух вариантах:
\begin{itemize}
	\item сквозная нумерация (номер формулы не зависит от раздела, в котором она находится);
	\item нумерация, зависящая от раздела (в том случае номер формулы начинается с номера раздела);
\end{itemize}
другое оформление считается ошибкой.

Отсутствие знака препинания после формулы является ошибкой. После каждой формулы должен находиться знак препинания (точка, запятая и т.~п.), зависящий от контекста. Если в формуле содержится система уравнений, то после каждого из них (за исключением последнего) ставится запятая, а после последнего --- точка, либо запятая (см. рисунок~\ref{img:eqSystemMist}).

Номер формулы должен быть выравнен по правому краю страницы и находиться по центру формулы (в вертикальной плоскости). Другое оформление нумерации формул считается не соответствующим стандарту.

Если формула вставляется в начале страницы, то часто перед ней может присутствовать отступ, которого быть не должно.

\subsection{Ошибки в списках}
Ненумерованные списки должны начинаться с удлиненного тире (см. рисунок~\ref{img:itemizeMist}), другое оформление является ошибочным.

В нумерованных списках после номера пункта обязательно должна стоять скобка (см. рисунок \ref{img:enumerateMist}), использование другого знака считается ошибкой.

В конце каждого пункта списка должен быть знак препинания, от которого зависит первая буква первого слова следующего пункта (см. рисунок~\ref{img:itemizeLettersMist}):
\begin{itemize}
	\item если пункт заканчивается на точку, то первое слово следующего пункта должно начинаться на прописную букву;
	\item если пункт заканчивается запятой или точкой с запятой, то следующий первое слово следующего слово должно начинаться со строчной буквы;
\end{itemize}
другое оформление является ошибочным.

\subsection{Ошибки в списке литературы}
Часто при описании одного из источников не указывается одна из составных частей (автор, издательство и т.~п.), что является ошибкой.

Также нередко встречаются ссылки на так называемые «препринтовские» издательства (статья еще не вышла), однако была использована в отчете, это считается ошибкой.

\section{Библиотеки по работе с PDF-файлами}
В данной части работы будут сравниваться существующие Python-библиотеки для извлечения данных из PDF-файлов, охватывая из возможности с точки зрения извлечения текста, изображений и таблиц, скорости выполнения и обширности функциональности.
\subsection{PyPDF2}
PyPDF2 - это библиотека на чистом Python, которая позволяет читать PDF-файлы и манипулировать ими. Хотя она в основном ориентирована на извлечение текста, она также предоставляет ограниченную поддержку для извлечения изображений. Однако извлечение таблиц не является встроенной функцией. PyPDF2 получил широкое распространение благодаря небольшой, но достаточной, функциональности и обширной документации.
\subsection{pdfminer.six}
pdfminer.six - это поддерживаемая сообществом библиотека Python, основанная на оригинальном проекте PDFMiner. Она предлагает расширенные возможности для извлечения текста из PDF-файлов, включая возможность извлекать информацию о макете текста. Однако она не обеспечивает прямой поддержки извлечения изображений или таблиц. pdfminer.six известен своей точностью при извлечении текста, так как была специально разработана для его извлечения из PDF-файлов.
\subsection{PyMuPDF}
PyMuPDF - это привязка Python для библиотеки MuPDF, которая известна своими высокопроизводительными возможностями рендеринга и синтаксического анализа. PyMuPDF предлагает обширные возможности для извлечения как текста, так и изображений из PDF-файлов. Хотя он не обеспечивает встроенного извлечения таблиц, он обеспечивает прочную основу для реализации пользовательских алгоритмов извлечения таблиц. PyMuPDF полностью документирован и предоставляет богатый набор функциональных возможностей.

